(function(t){function e(e){for(var r,l,o=e[0],s=e[1],c=e[2],d=0,h=[];d<o.length;d++)l=o[d],i[l]&&h.push(i[l][0]),i[l]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);u&&u(e);while(h.length)h.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],r=!0,o=1;o<n.length;o++){var s=n[o];0!==i[s]&&(r=!1)}r&&(a.splice(e--,1),t=l(l.s=n[0]))}return t}var r={},i={app:0},a=[];function l(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,l),n.l=!0,n.exports}l.m=t,l.c=r,l.d=function(t,e,n){l.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},l.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},l.t=function(t,e){if(1&e&&(t=l(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)l.d(n,r,function(e){return t[e]}.bind(null,r));return n},l.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return l.d(e,"a",e),e},l.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},l.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],s=o.push.bind(o);o.push=e,o=o.slice();for(var c=0;c<o.length;c++)e(o[c]);var u=s;a.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"21bb":function(t,e,n){"use strict";var r=n("bcc9"),i=n.n(r);i.a},"56d7":function(t,e,n){"use strict";n.r(e);n("cadf"),n("551c"),n("097d");var r=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},a=[],l=(n("5c0b"),n("2877")),o={},s=Object(l["a"])(o,i,a,!1,null,null,null),c=s.exports,u=n("8c4f"),d=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"home"},[n("h1",[t._v("创建你的习惯热图")]),t._m(0),n("HeatMap")],1)},h=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ol",[n("li",[t._v("下载模板")]),n("li",[t._v("填写你的习惯项目，并在对应日期与项目内打钩")]),n("li",[t._v("导出为 .csv 格式 （文件-> 导出到 -> csv）")]),n("li",[t._v("上传文件，选择修改保存后的csv文件")]),n("li",[t._v("生成你的习惯热图")])])}],f=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"heatmap-wrap"},[n("div",{staticClass:"tool-bar"},[n("button",{staticClass:"button",on:{click:t.download}},[t._v("\n      下载模板\n    ")]),n("button",{staticClass:"button"},[n("label",[n("input",{attrs:{type:"file"},on:{change:t.getFile}}),t._v("\n          上传文件\n      ")])])]),n("div",{staticClass:"heatmap",attrs:{id:"heatmap"}})])},p=[],y=n("b6d0"),m=n.n(y),g=n("75fc"),b=n("774e"),v=n.n(b),x=n("cebc"),w=(n("c5f6"),n("5698")),S={date:w["f"]("%B %d, %Y"),yearDay:w["f"]("%j"),day:w["f"]("%d"),weekday:w["f"]("%a"),month:w["f"]("%b"),fullMonth:w["f"]("%B")},k={month:{January:"一月"},weekday:{en:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]}},T={name:"HeatMap",props:{theme:{type:String,default:"light"},cellSize:{type:Number,default:20},buckets:{type:Number,default:4},colors:{type:Array,default:function(){return["#636cff","#f981b7","#82adcf","#f29e78","#44c0c9","#2196f3","#9c27b0","#ffc107","#f44336"]}},margin:{type:Object,default:function(){return{top:30,right:90,bottom:50,left:50}}}},data:function(){return{svg:null,toolTip:null,finishingRate:null,data:[],key:null,height:0}},computed:{rows:function(){return this.data&&this.data.columns.filter(function(t){return t})},colNumber:function(){return Math.ceil(this.data.length/7)},rowNumber:function(){return 7}},methods:{download:function(){window.open("/data/template.numbers")},getFile:function(t){var e=this,n=t.target.files[0],r=new FileReader;r.readAsText(n),r.onload=function(t){document.querySelector("#heatmap").innerHTML="",e.finishingRate=null,e.data=w["c"](t.target.result,function(t){return Object(x["a"])({},t,{date:new Date(t.date)})}),e.render(e.data)}},initData:function(){var t=this,e="/data/checklist.csv";w["b"](e,function(t){return Object(x["a"])({},t,{date:new Date(t.date)})}).then(function(e){t.data=e,t.render(t.data)})},initSvg:function(){this.height=this.rowNumber*this.cellSize+this.margin.top+this.margin.bottom,this.svg=w["e"]("#heatmap").append("svg").attr("width",this.colNumber*this.cellSize+this.margin.left+this.margin.right).attr("height",this.height).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")")},renderToolTip:function(){this.toolTip||(this.toolTip=w["e"]("body").append("div").attr("class","tooltip").style("opacity",0))},renderLabel:function(){var t=this,e=v()(this.data,function(t){return S.month(t.date)}),n=this.data.filter(function(t){return S.weekday(t.date)===k.weekday.en[0]}),r=Object(g["a"])(new m.a(e));this.svg.selectAll(".x-labels").data(r).enter().append("text").text(function(t){return t}).attr("x",function(e,r){var i=0;return n.map(function(n){S.month(n.date)===e&&(i=Math.floor(+S.yearDay(n.date)/7)*t.cellSize)}),i}).attr("y",0).style("text-anchor","middle").attr("transform","translate(".concat(this.cellSize/2,", -4)")).attr("class","x-labels"),this.svg.selectAll(".y-labels").data(k.weekday.en).enter().append("text").text(function(t){return t}).attr("x",0).attr("y",function(e,n){return n*t.cellSize}).style("text-anchor","end").attr("transform","translate(-6,"+this.cellSize/1.5+")",-100).attr("class","y-labels")},renderCell:function(){var t=this,e=this,n=this.rows.slice(1),r=this.colors[n.indexOf(this.key)],i=this.svg.selectAll(".item").data(this.data).enter().append("rect").attr("width",this.cellSize).attr("height",this.cellSize).attr("rx",4).attr("ry",4).attr("x",function(e,n){return Math.floor(+S.yearDay(e.date)/7)*t.cellSize}).attr("y",function(e,n){return k.weekday.en.indexOf(S.weekday(e.date))*t.cellSize});i.style("fill","#ddd").style("stroke","#fff").style("stroke-width",1).transition().delay(300).style("fill",function(e,n){var i=w["a"](r);return"TRUE"===e[t.key]?i:"#ddd"}).attr("class","card"),i.on("mouseover",function(t,n){e.toolTip.transition().duration(200).style("opacity",.9),e.toolTip.html(S.date(t.date)).style("left",w["d"].pageX+2+"px").style("top",w["d"].pageY+2+"px"),w["e"](this).transition().duration(100).style("fill-opacity",.8)}).on("mousemove",function(t,n){e.toolTip.html(S.date(t.date)).style("left",w["d"].pageX+"px").style("top",w["d"].pageY+"px")}).on("mouseout",function(){w["e"](this).transition().duration(100).style("fill-opacity",1),e.toolTip.transition().duration(500).style("opacity",0)})},renderLegend:function(){var t=this,e={width:20,height:14},n={x:10,y:10},r=this.rows.slice(1),i=this.svg.selectAll(".legends").data(r);i.enter().append("rect").attr("width",e.width).attr("height",e.height).style("fill",function(e,n){return t.colors[n]}).attr("x",this.colNumber*this.cellSize+this.margin.right-e.width-n.x).attr("y",function(t,r){return r*(e.height+n.y)}).attr("class","legends").on("click",function(e){t.key=e,t.renderCell(),t.renderText()}),i.enter().append("text").text(function(t){return t}).attr("x",this.colNumber*this.cellSize+this.margin.right-e.width-n.x-5).attr("y",function(t,r){return r*(e.height+n.y)}).style("fill",function(e,n){return t.colors[n]}).style("text-anchor","end").attr("dy","1em").attr("class","legends-text")},renderText:function(){var t=this;this.finishingRate||(this.finishingRate=this.svg.append("text"),this.svg.append("text").text("热度公式：当前完成天数/今年已过去天数").attr("x",0).attr("y",this.rowNumber*this.cellSize+40).style("fill","#999").style("font-size","12px"));var e=v()(this.data,function(e){return e[t.key]}).filter(function(t){return"TRUE"===t}),n=e.length/S.yearDay(new Date)*100;this.finishingRate.text("".concat(this.key," 热度： ").concat(n.toFixed(2)," %")).attr("x",0).attr("y",this.rowNumber*this.cellSize+20).style("fill","#666").style("font-size","13px")},render:function(){this.key=this.data.columns[1],this.initSvg(),this.renderLabel(),this.renderCell(),this.renderLegend(),this.renderText()}},mounted:function(){this.initData(),this.renderToolTip()}},_=T,O=(n("6c97"),Object(l["a"])(_,f,p,!1,null,null,null)),z=O.exports,j={name:"home",components:{HeatMap:z}},M=j,N=(n("21bb"),Object(l["a"])(M,d,h,!1,null,null,null)),C=N.exports;r["a"].use(u["a"]);var D=new u["a"]({mode:"history",base:"/",routes:[{path:"/",name:"home",component:C}]});r["a"].config.productionTip=!1,new r["a"]({router:D,render:function(t){return t(c)}}).$mount("#app")},"5c0b":function(t,e,n){"use strict";var r=n("5e27"),i=n.n(r);i.a},"5e27":function(t,e,n){},"6c97":function(t,e,n){"use strict";var r=n("e78c"),i=n.n(r);i.a},bcc9:function(t,e,n){},e78c:function(t,e,n){}});
//# sourceMappingURL=app.89f414fa.js.map